<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      body { font-family: system-ui, sans-serif; margin: 0; }
      .wrap { width: 360px; padding: 12px; }
      h1 { font-size: 15px; margin: 0 0 8px; }
      label { display:block; font-size: 12px; margin-top: 10px; font-weight: bold; }
      input, textarea { width: 100%; box-sizing: border-box; padding: 8px; }
      textarea { height: 64px; resize: vertical; }
      button { width: 100%; padding: 10px; margin-top: 10px; cursor: pointer; }
      button.primary { background: #1a73e8; color: white; border: none; border-radius: 4px; }
      button.primary:hover { background: #1557b0; }
      button.danger { background: #d93025; color: white; border: none; border-radius: 4px; }
      button.danger:hover { background: #b3221b; }
      button.execute { background: #ff9800; color: white; border: none; border-radius: 4px; }
      button.execute:hover:not(:disabled) { background: #e68900; }
      button.execute:disabled { background: #ccc; color: #888; cursor: not-allowed; }
      button.stop { background: #d93025; color: white; border: none; border-radius: 4px; display: none; }
      button.stop:hover { background: #b3221b; }
      .auto-run-row { display: flex; gap: 6px; margin-top: 10px; align-items: center; }
      .auto-run-row button { flex: 1; margin-top: 0; }
      .auto-run-row input { width: 60px; flex: 0 0 60px; text-align: center; padding: 8px 4px; }
      .auto-run-row label { flex: 0 0 auto; font-size: 11px; margin: 0; white-space: nowrap; }
      .step-counter { font-size: 11px; color: #666; margin-top: 4px; display: none; }
      .exec-result { font-size: 11px; padding: 6px 8px; border-radius: 4px; margin-top: 6px; display: none; }
      .exec-result.success { display: block; background: #e8f5e9; color: #2e7d32; }
      .exec-result.error { display: block; background: #fbe9e7; color: #c62828; }
      pre { white-space: pre-wrap; background:#f6f6f6; padding:8px; border-radius:6px; font-size:12px; }
      .task-info { background: #e8f0fe; padding: 10px; border-radius: 6px; margin-top: 10px; font-size: 12px; }
      .task-info strong { display: block; margin-bottom: 4px; }
      details { margin-top: 6px; }
      details summary { cursor: pointer; font-size: 12px; color: #555; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>UX Capture + AI</h1>

      <!-- Task 세션 영역 -->
      <div id="taskSection">
        <label>Task 이름</label>
        <input id="taskName" placeholder="예: 네이버쇼핑 노트북 검색 플로우" />
        <button id="startTask" class="primary">Task 시작</button>
      </div>

      <!-- Task 진행 중일 때만 표시 -->
      <div id="activeTaskSection" style="display:none">
        <div class="task-info">
          <strong>진행 중 Task: <span id="currentTaskName"></span></strong>
          <small>캡처 횟수: <span id="captureCount">0</span></small>
        </div>

        <div class="auto-run-row">
          <button id="autoRun" class="primary">Auto Run</button>
          <button id="stopRun" class="stop">Stop</button>
          <label>Max</label>
          <input id="maxSteps" type="number" value="20" min="1" max="100" />
        </div>
        <div id="stepCounter" class="step-counter">Step <span id="currentStep">0</span> / <span id="maxStepDisplay">20</span></div>

        <button id="captureViewport" class="primary" style="font-size:12px; padding:6px;">수동 캡처</button>
        <button id="endTask" class="danger">Task 종료</button>
      </div>

      <!-- 상태 메시지 -->
      <pre id="out" style="font-size:11px; color:#666;">Ready.</pre>

      <!-- Reasoning 출력 (접을 수 있음) -->
      <label>AI 상황 분석</label>
      <details open>
        <summary>상세 보기</summary>
        <pre id="reasoningOut">Ready.</pre>
      </details>

      <!-- Action 출력 (녹색 강조) -->
      <label>추천 액션</label>
      <pre id="actionOut" style="background:#e8f5e9; border-left:3px solid #4caf50;">Ready.</pre>
      <button id="executeAction" class="execute" disabled>액션 실행</button>
      <div id="execResult" class="exec-result"></div>

      <!-- 디버그 프롬프트 -->
      <details>
        <summary>Show prompts (debug)</summary>
        <pre id="debugPrompt">(empty)</pre>
      </details>
    </div>

    <script src="sidepanel.js"></script>
  </body>
</html>
